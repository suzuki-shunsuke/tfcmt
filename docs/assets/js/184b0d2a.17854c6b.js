"use strict";(self.webpackChunktfcmt=self.webpackChunktfcmt||[]).push([[65],{5680:(e,t,n)=>{n.d(t,{xA:()=>m,yg:()=>h});var a=n(6540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function p(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},s="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef(function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,m=p(e,["components","mdxType","originalType","parentName"]),s=c(n),g=o,h=s["".concat(l,".").concat(g)]||s[g]||u[g]||r;return n?a.createElement(h,i(i({ref:t},m),{},{components:n})):a.createElement(h,i({ref:t},m))});function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=g;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p[s]="string"==typeof e?e:o,i[1]=p;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},5852:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>p,toc:()=>c});var a=n(8168),o=(n(6540),n(5680));const r={sidebar_position:550},i="Patch tfcmt plan comment",p={unversionedId:"plan-patch",id:"plan-patch",title:"Patch tfcmt plan comment",description:"tfcmt >= v3.2.0 | #199 #245 #248 #249",source:"@site/docs/plan-patch.md",sourceDirName:".",slug:"/plan-patch",permalink:"/tfcmt/plan-patch",draft:!1,editUrl:"https://github.com/suzuki-shunsuke/tfcmt-docs/edit/main/docs/plan-patch.md",tags:[],version:"current",sidebarPosition:550,frontMatter:{sidebar_position:550},sidebar:"tutorialSidebar",previous:{title:"Compared with tfnotify v0.7.0",permalink:"/tfcmt/compared-with-tfnotify"},next:{title:"Mask sensitive data",permalink:"/tfcmt/mask-sensitive-data"}},l={},c=[{value:"Motivation",id:"motivation",level:3},{value:"Using <code>-patch</code> with monorepos containing multiple root modules (tfstates)",id:"using--patch-with-monorepos-containing-multiple-root-modules-tfstates",level:3},{value:"Trouble shooting",id:"trouble-shooting",level:3},{value:"\u26a0\ufe0f Note to use  tfcmt plan&#39;s patch option with github-comment hide",id:"\ufe0f-note-to-use--tfcmt-plans-patch-option-with-github-comment-hide",level:3}],m={toc:c},s="wrapper";function u({components:e,...t}){return(0,o.yg)(s,(0,a.A)({},m,t,{components:e,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"patch-tfcmt-plan-comment"},"Patch ",(0,o.yg)("inlineCode",{parentName:"h1"},"tfcmt plan")," comment"),(0,o.yg)("p",null,"tfcmt >= ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/suzuki-shunsuke/tfcmt/releases/tag/v3.2.0"},"v3.2.0")," | ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/suzuki-shunsuke/tfcmt/issues/199"},"#199")," ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/suzuki-shunsuke/tfcmt/issues/245"},"#245")," ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/suzuki-shunsuke/tfcmt/issues/248"},"#248")," ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/suzuki-shunsuke/tfcmt/issues/249"},"#249")),(0,o.yg)("p",null,"Instead of creating a new comment, you can update existing comment. This is useful to keep the pull request comments clean."),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/13323303/164969354-02bdd49a-547e-4951-9262-033ec5b4db11.png",alt:"image"})),(0,o.yg)("p",null,"--"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/13323303/164969385-355e801e-3d58-4b75-9657-0bcc10da8d12.png",alt:"image"})),(0,o.yg)("p",null,"The option ",(0,o.yg)("inlineCode",{parentName:"p"},"-patch")," has been added to ",(0,o.yg)("inlineCode",{parentName:"p"},"tfcmt plan")," command."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"tfcmt plan -patch -- terraform plan -no-color\n")),(0,o.yg)("p",null,"And the configuration option ",(0,o.yg)("inlineCode",{parentName:"p"},"plan_patch")," has been added."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"plan_patch: true\n")),(0,o.yg)("p",null,"The command line option ",(0,o.yg)("inlineCode",{parentName:"p"},"-patch")," takes precedence over configuration file option ",(0,o.yg)("inlineCode",{parentName:"p"},"plan_patch"),"."),(0,o.yg)("p",null,"If you want to disable patching although ",(0,o.yg)("inlineCode",{parentName:"p"},"plan_patch")," is true, please set ",(0,o.yg)("inlineCode",{parentName:"p"},"-patch=false"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"tfcmt plan -patch=false -- terraform plan -no-color\n")),(0,o.yg)("h3",{id:"motivation"},"Motivation"),(0,o.yg)("p",null,"By patching the comment instead of creating a new comment, you can keep the pull request comments clean."),(0,o.yg)("h3",{id:"using--patch-with-monorepos-containing-multiple-root-modules-tfstates"},"Using ",(0,o.yg)("inlineCode",{parentName:"h3"},"-patch")," with monorepos containing multiple root modules (tfstates)"),(0,o.yg)("p",null,"You can specify the ",(0,o.yg)("inlineCode",{parentName:"p"},"target")," variable to instruct tfcmt which comments should be updated:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"cd /path/to/root-modules/dev\ntfcmt -var 'target:dev' plan -patch -- terraform plan -no-color\n\ncd /path/to/root-modules/prd\ntfcmt -var 'target:prd' plan -patch -- terraform plan -no-color\n")),(0,o.yg)("p",null,"See also ",(0,o.yg)("a",{parentName:"p",href:"getting-started#monorepo-support-target-variable"},"Monorepo support: target variable"),"."),(0,o.yg)("h3",{id:"trouble-shooting"},"Trouble shooting"),(0,o.yg)("p",null,"If the comment isn't patched expectedly, please set ",(0,o.yg)("inlineCode",{parentName:"p"},"-log-level=debug"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"tfcmt -log-level=debug plan -patch -- terraform plan -no-color\n")),(0,o.yg)("h3",{id:"\ufe0f-note-to-use--tfcmt-plans-patch-option-with-github-comment-hide"},"\u26a0\ufe0f Note to use  tfcmt plan's patch option with github-comment hide"),(0,o.yg)("p",null,"If you hide comments by ",(0,o.yg)("a",{parentName:"p",href:"https://suzuki-shunsuke.github.io/github-comment/hide"},"github-comment hide")," and enable tfcmt plan's patch option,\nyou should be careful not to hide tfcmt plan's comments."),(0,o.yg)("p",null,"There are some ways to fix the problem."),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},"Stop using ",(0,o.yg)("inlineCode",{parentName:"li"},"github-comment hide")),(0,o.yg)("li",{parentName:"ol"},"Fix github-comment hide's condition and exclude tfcmt's comments from the target ofgithub-comment hide"),(0,o.yg)("li",{parentName:"ol"},"Run github-comment hide after tfcmt")))}u.isMDXComponent=!0}}]);