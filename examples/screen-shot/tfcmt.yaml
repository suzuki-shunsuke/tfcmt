---
templates:
  title_apply: '{{if eq .ExitCode 0}}{{template "apply_title" .}}{{else}}## :x: Apply Failed ({{.Vars.target}}){{end}}'
  changed_result: |
    {{if .ChangedResult}}
    <details><summary>Change Result (Click me)</summary>
    {{wrapCode .ChangedResult}}
    </details>
    {{end}}
  change_outside_terraform: |
    {{if .ChangeOutsideTerraform}}
    <details><summary>:information_source: Objects have changed outside of Terraform</summary>

    _This feature was introduced from [Terraform v0.15.4](https://github.com/hashicorp/terraform/releases/tag/v0.15.4)._
    _If you don't know this feature, you can ignore this._
    {{wrapCode .ChangeOutsideTerraform}}
    </details>
    {{end}}
  warning: |
    {{if .Warning}}
    ## :warning: Warnings :warning:
    {{wrapCode .Warning}}
    {{end}}
  error_message: |
    {{if .ErrorMessages}}
    ## :warning: Errors
    {{range .ErrorMessages}}
    * {{. -}}
    {{- end}}{{end}}

terraform:
  plan:
    template: |
      {{template "plan_title" .}}

      {{if .Link}}[CI link]({{.Link}}){{end}}

      {{if .HasDestroy}}{{template "deletion_warning" .}}{{end}}
      {{template "result" .}}
      {{template "updated_resources" .}}

      {{template "changed_result" .}}
      {{template "change_outside_terraform" .}}
      {{template "warning" .}}
      {{template "error_message" .}}
  apply:
    template: |
      {{template "title_apply" .}}

      [CI link]({{ .Link }})

      {{if ne .ExitCode 0}}@{{.Vars.owner}} Please check the error.{{end}}

      {{template "result" .}}

      <details><summary>Details (Click me)</summary>
      {{wrapCode .CombinedOutput}}
      </details>
      {{template "error_message" .}}
    when_parse_error:
      template: |
        {{template "title_apply" .}}

        [CI link]({{ .Link }})

        {{if ne .ExitCode 0}}@{{.Vars.owner}} Please check the error.{{end}}

        It failed to parse the result.

        <details><summary>Details (Click me)</summary>
        {{wrapCode .CombinedOutput}}
        </details>
